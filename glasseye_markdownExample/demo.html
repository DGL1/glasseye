<!DOCTYPE html>
<head>
  <meta charset="utf-8"/>
  <title>Glasseye</title>
  <link href='http://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Droid%20Sans' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="css/tufte.css"/>
  <link rel="stylesheet" href="css/glasseyeCharts.css"/>
  <link rel="stylesheet" href="font-awesome/css/font-awesome.min.css">
  <script src="js/d3.min.js"></script>
  <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
  <script src="js/glasseyeCharts.js"></script>
</head>
<body>
  
<div id = "tufte_container"><h2 id="a-glasseye-demo">A Glasseye Demo</h2>
<h2 id="what-is-glasseye">What is glasseye?</h2>
<p>Glasseye<sup>1</sup><span class="marginnote">1. See the <a href="https://github.com/coppeliaMLA/glasseye">github repository</a> for the source code</span> is something I'm developing to present the results of statistical analysis in an attractive and hopefully interesting way. It brings together three great things that I use a lot:</p>
<div class="list-container"><ol style="list-style-type: decimal">
<li>The markdown markup language.</li>
<li>The Tufte wide margin layout</li>
<li>Visualisation using d3.js</li>
</ol></div>
<p>The idea is to be able to write up work in markdown<sup>2</sup><span class="marginnote">2. Markdown is a lightweight markup language with a simple easy-to-use syntax. Text written in markdown can be converted into HTML as well as a many other formats</span> and have the results transformed into something like a Tufte layout<sup>3</sup><span class="marginnote">3. The Tufte layout makes extenive use of a wide margin to display notes, images and charts. <img alt="" src="Tufte.gif"/></span>. For the Tufte layout I took the excellent tufte.css style sheet developed by <a href="https://github.com/daveliepmann/tufte-css">Dave Liepmann and co</a> and adapted it for my purposes. Finally I've added some d3 charts (just a small selection at the moment but this is growing) that can easily invoked from within the markdown.</p>
<h2 id="what-it-can-do">What it can do</h2>
<p>In case it's not obvious this web page was written using glasseye<sup>4</sup><span class="marginnote">4. You can view the markdown <a href="viewMarkdown.txt">here</a></span>, that it is it was written in markdown with a few extra html-like tags thrown in.</p>
<h3 id="side-notes-and-margin-notes">Side notes and margin notes</h3>
<p>First there's the <code>&lt;sidenote&gt;</code> tag. Anything enclosed in these tags will generate a numbered side note in the wide margin as close as possible to the note number in the main text. For example, I've used one here.<sup>5</sup><span class="marginnote">5. I'm a side note! Use me for commentary, links, bits of maths, anything that's peripheral to the main discussion.</span>.</p>
<p>You can easily add images to the side notes and margin notes just by including the usual markdown syntax for inserting an image<sup>6</sup><span class="marginnote">6. The syntax is <code>![alt text](filename)</code></span> within the tags.</p>
<p>Then there is a <code>&lt;marginnote&gt;</code> tag which is the nearly the same as the side note, only there's no number linking it to a particular part in the main text. You'll see to the right an example of a margin note containing a d3 donut chart.</p>
<p><p><span class="marginnote"> An example of margin note containing a donut plot. Because a tooltip is available we can create a less cluttered chart with labels for the smaller segments demoted to the tooltip.<span id="donut_0"></span><br/>Including d3 charts in a glasseye document is very easy. You just need to surround the name of the file containing the data with tags specfying the type of chart. For example this chart was generated using <code>&lt;donut&gt;"data/share.csv"&lt;/donut&gt;</code> </span></p></p>
<h3 id="latex">Latex</h3>
<p>I'm using pandoc to convert the markdown to html which means we can take advantage of its ability to transform latex into mathjax. For example the formula below was written in latex.</p>
<p><span class="math display">\[E[L]= \frac{1}{B(\alpha)}\int \cdots \int_\mathbf{D}\ \sum_{j=1}^N \theta_{j}^2 \ \prod_{j=1}^N \theta_j^{\alpha_j-1} \ d\theta_1 \!\cdots d\theta_N \]</span></p>
<p>However sometimes the mathematical details are not central to a discussion, in which case it's nice to put them in a side note which can be easily done using the sidenote or marginnote tags<sup>7</sup><span class="marginnote">7.  Here's an example of some maths that has been placed in a side note <span class="math display">\[ f(\theta_1,\dots, \theta_N; \alpha_1,\dots, \alpha_N) = \frac{1}{\mathrm{B}(\alpha)} \prod_{i=1}^N \theta_i^{\alpha_i - 1} \]</span> Where the normalising constant is: <span class="math display">\[ \mathrm{B}(\alpha) = \frac{\prod_{i=1}^N \Gamma(\alpha_i)}{\Gamma\bigl(\sum_{i=1}^N \alpha_i\bigr)},\qquad\alpha=(\alpha_1,\dots,\alpha_N)\]</span> </span></p>
<h3 id="d3-charts">d3 charts</h3>
<p>I've tried to create charts that are simple and uncluttered with the tooltip taking over some of the work. This is so that they can fit in the margin nicely. I've been thinking about making them as intellegent as possible so that choices are made for you about formatting (for example label positioning). That may prove annoying though so we'll see how it goes. It's easy to include any of the d3 charts into either the main body of the text or into the margin.</p>
<p>Inserting a plot is again just a matter of using some custom tags. For example to generate a line plot just surround a string containing the path and filname of a csv file with a <code>&lt;lineplot&gt;</code> tag. You can optionally supply axis labels.<sup>8</sup><span class="marginnote">8.  An example of a line plot. Note the tooltip means we don't need y axis tick labels. <span id="lineplot_0"></span><br/> This plot was created by inserting the following line into the markdown. <code>&lt;lineplot&gt;"data/lineplotExample.csv", ["Size", "Number of explosions"]&lt;/lineplot&gt;</code></span></p>
<p>Alternatively you can write the data in json into the markdown. For example we can create an interactive treemap<sup>9</sup><span class="marginnote">9. An example of an intreactive treemap. Click on the rectangles to zoom in <span id="treemap_0"></span><br/> </span> by inserting the following into the markdown<sup>10</sup><span class="marginnote">10. See the section below for the full json</span></p>
<pre><code>
&lt;treemap&gt;
{
    "name": "All",
    "children": [
        {"name": "Bakery",
         "size": 34},
        {"name": "Tinned Goods",
         "children": [
                {"name": "Beans",
                 "size": 34},
                {"name": "Soups",
                 "size": 56},
                {"name": "Puddings",
                 "children": [
                        {"name": "Fruit",
                         "children": [
                                {"name": "Tangerines",
                                 "size": 15},
                                {"name": "Pears",
                                 "size": 17}
                            ]
                        },
                        {"name": "Apricots",
                         "size": 89}
...
&lt;/treemap&gt;</code></pre>
<p>Javascript charts also allow us to animate content which can be useful. I created a chart type <code>&lt;sim_plot&gt;</code> for a project using agent based simulation. It animates a time line which helps bring home the fact that the data is computer generated</p>
<p><span id="simplot_0"></span><br/></p>
<h2 id="how-it-works">How it works</h2>
<p>Glasseye is built using pandoc and the python beautifulsoup library. Pandoc is used to generate the html from the markdown and beautifulsoup is used to manipulate the extra tags and make the appropriate substitutions, including adding in the d3 charts.</p>
<h2 id="installing-glasseye">Installing glasseye</h2>
<p>I've now added glasseye to pip so installation is fairly straightforward</p>
<div class="list-container"><ol style="list-style-type: decimal">
<li>Install pandoc from <a href="http://pandoc.org">here</a></li>
<li>If you don't have it already install python 2.7</li>
<li>Then from the command line run <code>pip install glasseye</code> <sup>11</sup><span class="marginnote">11. Assumes you already have the pip package. If you don't just run <code>easy_install pip</code></span></li>
</ol></div>
<h2 id="using-glasseye">Using glasseye</h2>
<p>Just create your markdown file using a text editor and then from the commandline run<sup>12</sup><span class="marginnote">12. Don't forget to include the path of the markdown file if you are not actually in its directory</span></p>
<pre><code>glasseye myMarkdownFile.md</code></pre>
<p>The html will then be created in the current directory along with the supporting css and javascript.</p>
<p>You can test it out using the demo that comes with the package. You'll find the demo files in <code>path_to_your_packages/glasseye/demo</code>. Copy them to a new directory and run</p>
<pre><code>glasseye markdownExample.md</code></pre>
<h2 id="the-charts">The charts</h2>
<p>In no particular order here are the d3 charts I have added so far.<sup>13</sup><span class="marginnote">13. You might be wondering why I've added these charts when there are so many basic charts that I haven't yet included. The answer is quite selfish. I'm just adding them as I need them. More will follow!</span>. Some of them can be generated from csv files some from inline json, some from both. The aim is for all to be generated from both.</p>
<h3 id="a-tree-layout">A tree layout</h3>
<p>This ia a fairly standard layout for a hierarchy, adapated from Mike Bostocks <a href="http://bl.ocks.org/mbostock/4063570">original design</a>.</p>
<p><span id="tree_0"></span><br/></p>
<p>Like all of the charts it can appear in the main body or in the margin.<sup>14</sup><span class="marginnote">14. The same tree layout as it appears in the margin.<span id="tree_1"></span><br/></span></p>
<p>To create a treelayout include some nested json within the tree tags.</p>
<pre><code>
&lt;tree&gt;
{
    "name": "root",
    "children": [
        {"name": "purpledog.com"},
        {"name": "squishedfish.co.uk"},
        {"name": "blogs",
         "children": [
                {"name": "political",
                 "children": [
                        {"name": "flatbat.com"},
                        {"name": "netfrog.co.uk"}
                    ]
                },
                {"name": "squarespider.com"}
            ]
        }
    ]
}
&lt;/tree&gt;</code></pre>
<h3 id="a-simple-bar-chart">A simple bar chart</h3>
<p>A simple bar chart can be created using the barchart tags.<sup>15</sup><span class="marginnote">15.  A bar chart as it appears in the margin. <span id="barchart_0"></span><br/> </span></p>
<pre><code>
&lt;barchart&gt;
{"category": ["Apples", "Pears", "Oranges"], "value": [33, 12, 9]}
&lt;/barchart&gt;</code></pre>
<h3 id="a-force-directed-layout">A force directed layout</h3>
<p>Another fairly standard chart in the d3 world, you can create a force directed layout of a graph using the force tags and some json.<sup>16</sup><span class="marginnote">16.  A force directed layout of a graph. <span id="force_0"></span><br/> </span></p>
<pre><code>
&lt;force&gt;
    {
    "nodes": [
        {"name": "squishedfish.com", "group": 1},
        {"name": "reddog.co.uk", "group": 1},
        {"name": "blankcat.com", "group": 2},
        {"name": "scrimpledfeet.com", "group": 2},
        {"name": "sickbag.com", "group": 2},
        {"name": "bluehouse.co.uk", "group": 3},
        {"name": "webbedcat.com", "group": 3},
        {"name": "flatrhino.co.uk","group": 1},
        {"name": "greycamel.com", "group": 3}
    ],
    "links": [
        { "source": 0, "target": 1, "value": 20 }, 
        { "source": 0, "target": 2, "value": 30 }, 
        { "source": 1, "target": 4, "value": 22 }, 
        { "source": 6, "target": 2, "value": 5 }, 
        { "source": 1, "target": 7, "value": 5 }, 
        { "source": 3, "target": 8, "value": 15 }, 
        { "source": 5, "target": 8, "value": 15 }
        ] 
    }
&lt;/force&gt;</code></pre>
<h3 id="a-gantt-chart">A gantt chart</h3>
<p>I find a simple version of a Gantt chart useful when creating plans and proposals. It gives a rough idea of the time scales involved. The syntax is as follows:</p>
<pre><code>&lt;gantt&gt;
        [{"task": "Analysis phase", "start": "01/03/2015", "end": "12/03/2015"}, 
        {"task": "Build phase", "start": "13/03/2015", "end": "24/03/2015"},
        {"task": "Testing phase", "start": "25/03/2015", "end": "15/04/2015"}]
&lt;/gantt&gt;</code></pre>
<p>This will give you the following</p>
<p><span id="gantt_0"></span><br/></p>
<h3 id="a-donut-chart">A donut chart</h3>
<p>As seen above, you can create a donut plot from a csv file (you just need columns with headings <code>label</code> and <code>value</code>). Alternatively you can use inline json as in this example.</p>
<pre><code>
&lt;donut&gt;
{
    "label":["Cats", "Dogs", "Monkeys", "Cabbages"], 
    "values": [100, 34, 22, 76]
 }
&lt;/donut&gt;</code></pre>
<p><p><span class="marginnote"> A donut created from inline json. <span id="donut_1"></span><br/> <p><span class="marginnote"></span></p></span></p></p>
<h3 id="a-line-chart">A line chart</h3>
<p>Similarly the line chart can be either created from a csv file (as long as it has columns with heading x and y) or from in line json. Here is an example.</p>
<pre><code>
&lt;lineplot&gt;
    {
        "x": [1, 3, 5, 6, 20, 22, 25], 
        "y": [100, 98, 66, 43, 23, 22, 45]
    }
&lt;/lineplot&gt;</code></pre>
<p><span id="lineplot_1"></span><br/></p>
<h3 id="a-tree-map">A tree map</h3>
<p>At present the treemap can only be generated from inline json. Here's the full json.</p>
<pre><code>
&lt;treemap&gt;
{
    "name": "All",
    "children": [
        {"name": "Bakery",
         "size": 34},
        {"name": "Tinned Goods",
         "children": [
                {"name": "Beans",
                 "size": 34},
                {"name": "Soups",
                 "size": 56},
                {"name": "Puddings",
                 "children": [
                        {"name": "Fruit",
                         "children": [
                                {"name": "Tangerines",
                                 "size": 15},
                                {"name": "Pears",
                                 "size": 17}
                            ]
                        },
                        {"name": "Apricots",
                         "size": 89} 
                                ] }] }, 
                { "name": "Meat and Fish", 
                   "children": [
                        { "name": "Meat", 
                          "children": [
                                { "name": "Poultry", 
                                  "size": 15 }, 
                                { "name": "Beef", 
                                  "size": 17 }
                                       ]}, 
                        { "name": "Fish", 
                          "size": 89 } 
                                ] 
                }
            ] 
}
&lt;/treemap&gt;
</code></pre>
    </div>

<script>simplot("data/activeDecidedSim.csv", '#simplot_0', 'full_page'); 
treemap({ "name": "All", "children": [{ "name": "Bakery", "size": 34 }, { "name": "Tinned Goods", "children": [{ "name": "Beans", "size": 34 }, { "name": "Soups", "size": 56 }, { "name": "Puddings", "children": [{ "name": "Fruit", "children": [{ "name": "Tangerines", "size": 15 }, { "name": "Pears", "size": 17 }]}, { "name": "Apricots", "size": 89 } ] }] }, { "name": "Meat and Fish", "children": [{ "name": "Meat", "children": [{ "name": "Poultry", "size": 15 }, { "name": "Beef", "size": 17 }]}, { "name": "Fish", "size": 89 } ] }] }, '#treemap_0', 'margin'); 
gantt( [{"task": "Analysis phase", "start": "01/03/2015", "end": "12/03/2015"}, {"task": "Build phase", "start": "13/03/2015", "end": "24/03/2015"}, {"task": "Testing phase", "start": "25/03/2015", "end": "15/04/2015"}] , '#gantt_0', 'full_page'); 
donut("data/share.csv", '#donut_0', 'margin'); 
donut( {"labels":["Cats", "Dogs", "Monkeys", "Cabbages"], "values": [100, 34, 22, 76]} , '#donut_1', 'margin'); 
barchart( {"category": ["Apples", "Pears", "Oranges"], "value": [33, 12, 9]} , '#barchart_0', 'margin'); 
tree( {"name": "root", "children": [{ "name": "purpledog.com" }, { "name": "squishedfish.co.uk" }, { "name": "blogs", "children": [{ "name": "political", "children": [{ "name": "flatbat.com" }, { "name": "netfrog.co.uk" }]}, { "name": "squarespider.com" } ] }]} , '#tree_0', 'full_page'); 
tree( {"name": "root", "children": [{ "name": "purpledog.com" }, { "name": "squishedfish.co.uk" }, { "name": "blogs", "children": [{ "name": "political", "children": [{ "name": "flatbat.com" }, { "name": "netfrog.co.uk" }]}, { "name": "squarespider.com" } ] }]} , '#tree_1', 'margin'); 
force( { "nodes": [{ "name": "squishedfish.com", "group": 1 }, { "name": "reddog.co.uk", "group": 1 }, { "name": "blankcat.com", "group": 2 }, { "name": "scrimpledfeet.com", "group": 2 }, { "name": "sickbag.com", "group": 2 }, { "name": "bluehouse.co.uk", "group": 3 }, { "name": "webbedcat.com", "group": 3 }, { "name": "flatrhino.co.uk", "group": 1 }, { "name": "greycamel.com", "group": 3 } ], "links": [{ "source": 0, "target": 1, "value": 20 }, { "source": 0, "target": 2, "value": 30 }, { "source": 1, "target": 4, "value": 22 }, { "source": 6, "target": 2, "value": 5 }, { "source": 1, "target": 7, "value": 5 }, { "source": 3, "target": 8, "value": 15 }, { "source": 5, "target": 8, "value": 15 }] } , '#force_0', 'margin'); 
lineplot("data/lineplotExample.csv", '#lineplot_0','margin', ["Size", "Number of explosions"]); 
lineplot({"x": [1, 3, 5, 6, 20, 22, 25], "y": [100, 98, 66, 43, 23, 22, 45]}, '#lineplot_1','full_page'); 
</script><script type="text/javascript">
(function () {
  var script = document.createElement("script");
  script.type = "text/javascript";
  script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
  document.getElementsByTagName("head")[0].appendChild(script);
})();
</script>

</body>
</html>
